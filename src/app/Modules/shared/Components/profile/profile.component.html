<div class="profile-container">
  <div class="w-full">
    <img class="w-full h-[20rem] rounded-xl "
      src="https://th.bing.com/th/id/OIP.92YijJkH3mzwAVTVCT3LOgHaEt?w=276&h=180&c=7&r=0&o=5&dpr=1.3&pid=1.7" />
  </div>
  <img class="relative top-[-75px] left-[30px] border-white [border-width:3px] bg-black rounded-full w-[8rem] h-[8rem] profilePicUser" 
    [src]="user?.profile_picture_url || 'assets/default-profile.png'" (click)="openProfileCard(user)" />

  <section class="flex justify-between">
    <div>
      <div class="flex">
      <div class="text-white font-medium text-2xl ml-9 username">
        {{user?.username}}
      </div>
      <!-- <div class="ml-9">
         <button (click)="changeFollowType()" class="border border-white bg-transparent text-white font-normal rounded-md px-6 py-2">{{user.follow_status}}</button>
      </div> -->
    </div>
      <div class="text-gray-300 font-light text-xl ml-9">
        {{user?.bio}}
        <!-- {{user.}} -->
      </div>
    </div>
    <div
      class="p-4 w-[full] rounded-2xl text-white flex font-normal text-[18px] shadow-md border-gray-600 [border-width:1px] bg-gray-900 mr-5">
      <div class="flex mx-2">
        <!-- <div class="mx-2">
          <mat-icon>groups</mat-icon>
        </div> -->
        <!-- <div>
          <div class="flex justify-center">{{user.followers_count}}</div>
          <div class="font-light text-gray-400 text-[12px]">Followers</div>
        </div> -->
      </div>
      <div class="flex mx-2">
        <div class="flex">
          <div class="mx-2">
            <mat-icon class="material-icon">table_edit</mat-icon>
          </div>
          <div>
            <div class="flex justify-center">{{user?.posts_count}}</div>
            <div class="font-light text-gray-400 text-[12px]">posts</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section
    class="flex text-white font-normal text-[18px] ml-9 mt-3 border-gray-600 [border-width:1px] bg-gray-900 p-2 rounded-2xl w-[40rem]">
    <div class="mx-4 cursor-pointer p-3" [ngClass]="{'bg-slate-800': selectedSection === 'posts'}"
      (click)="selectSection('posts')">Posts</div>

    <div *ngIf="!routedFileds" class="mx-4 cursor-pointer p-3 collectionLable"
      [ngClass]="{'bg-slate-800': selectedSection === 'collections'}" (click)="selectSection('collections')">Collections
    </div>

    <div class="mx-4 cursor-pointer p-3 followersLable" [ngClass]="{'bg-slate-800': selectedSection === 'followers'}"
      (click)="selectSection('followers')">Followers</div>
    
    <div class="mx-4 cursor-pointer p-3 followingLable" [ngClass]="{'bg-slate-800': selectedSection === 'following'}"
      (click)="selectSection('following')">Following</div>
  </section>

  <!-- Section Content (Sliding Effect) -->
  <div class="section-container" *ngIf="showAllContent">
    <div [ngSwitch]="selectedSection" class="transition-transform duration-300 ease-in-out">
      <!-- Posts Section -->
      <div *ngSwitchCase="'posts'" class="section bg-slate-700 m-3 rounded-md p-8">

        <div *ngIf="media?.length == 0 || media.length < 0" class="text-gray-300 text-lg flex justify-center my-3">
          <!-- <div>No posts available.</div> -->
          <section *ngIf="!routedFileds"
            class="flex flex-col items-center justify-center p-5 bg-gray-900 text-white rounded-xl shadow-xl w-[22rem] h-[26rem] cursor-pointer transition-transform transform hover:scale-105">

            <label for="imageInput" class="flex flex-col items-center justify-center w-full h-full cursor-pointer">
              <span class="material-icons text-gray-400 text-6xl">photo_camera</span>
              <div class="text-lg font-medium mt-3 text-center">Add New</div>
            </label>

            <input id="imageInput" type="file" accept="image/*" multiple class="hidden"
              (change)="uploadPicture($event)" />

          </section>
        </div>
        <div class="flex flex-wrap gap-6 mt-10 mx-6 p-4 " *ngIf="media.length > 0">
          <!-- Camera Icon Section -->
          <section *ngIf="!routedFileds"
            class="flex flex-col items-center justify-start p-5 bg-gray-900 text-white rounded-xl shadow-xl w-[22rem] h-[28rem] cursor-pointer transition-transform transform hover:scale-105">

            <label for="imageInput" class="flex flex-col items-center justify-center w-full h-full cursor-pointer">
              <span class="material-icons text-gray-400 text-6xl">photo_camera</span>
              <div class="text-lg font-medium mt-3 text-center">Add New</div>
            </label>

            <input id="imageInput" type="file" accept="image/*" multiple class="hidden"
              (change)="uploadPicture($event)" />

          </section>

          <section *ngFor="let post of media; let i = index"
            class="flex flex-col items-center p-5 bg-gray-900 text-white rounded-xl shadow-xl w-[22rem] transition-transform transform">
            <!-- <div class="w-[22rem] h-[22rem] overflow-hidden rounded-lg shadow-md px-4">
              <img [src]="post.media_url" alt="Post Image" class="w-full h-full object-cover" />
            </div> -->

            <div class="relative w-[22rem] h-[22rem] overflow-hidden rounded-lg shadow-md px-4 group">
              <!-- Image -->
              <img [src]="post.media_url" alt="Post Image" class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105 imageSection" />
            
              <!-- Hover Overlay -->
              <div *ngIf="!routedFileds" class="absolute inset-0 bg-black bg-opacity-50 flex items-end justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                <div class="flex space-x-4 mb-4">
                  <button class="bg-red-500 bg-opacity-30 backdrop-blur-md text-white p-2 rounded-full shadow-lg hover:bg-red-700 hover:bg-opacity-50" (click)="deletePost(post)">
                    <span class="material-icons deleteIcon">delete</span>
                  </button>
                
                  <button class="bg-gray-500 bg-opacity-30 backdrop-blur-md text-white p-2 rounded-full shadow-lg hover:bg-gray-700 hover:bg-opacity-50" (click)="openProfileData(post)">
                    <span class="material-icons">comment</span>
                  </button>
                </div>
                
              </div>
            </div>
            <div class="text-lg font-medium mt-3 px-2 text-center">
              {{ post.caption }}
            </div>
            <!-- Likes and Comments -->
            <div class="flex w-full px-4 mt-3 text-gray-300 text-sm">
              <div class="heart-container cursor-pointer" (click)="toggleLike(post, i)">
                <span class="material-icons" [ngClass]="{
                  'text-red-500': isLikedByCurrentUser(post), 
                  'text-gray-300': !isLikedByCurrentUser(post)
                }">
                  {{ isLikedByCurrentUser(post) ? 'favorite' : 'favorite_border' }}
                </span>

                <span class="text-gray-400 mx-2 font-normal">{{ post?.likes_count }}</span>
                <!-- Floating hearts -->
                <span *ngFor="let heart of post.floatingHearts" class="floating-heart material-icons">
                  favorite
                </span>
              </div>
              <div class="mx-2">
                <span class="material-icons" (click)="openProfileData(post)">chat_bubble_outline</span>
              </div>
              <!-- Comment Box (Appears when showComments is true) -->
            </div>
            <div *ngIf="post.showComments" class="comment-box show">
              <div class="comments-container">
                <!-- Existing comments -->
                <div *ngFor="let comment of post.comments" class="comment">
                  <div class="flex">
                    <div>
                      <img [src]="comment.profile_pic || 'assets/default-profile.png'"
                        class="rounded-full w-5 h-5 mx-2 border border-gray-100" />
                    </div>
                    <div class="text-gray-200 font-medium mx-1">{{comment.username}}</div>
                    <div class="text-gray-400 font-light mx-1"> {{ comment.text }}</div>
                    <div><mat-icon class="material-icon">favourite-border</mat-icon></div>
                  </div>
                </div>
              </div>

              <!-- Comment Input Field -->
              <div class="comment-input-container">
                <input #commentInput type="text" placeholder="Add a comment..." class="comment-input" />
                <button (click)="addComment(post, commentInput)" class="post-button">Post</button>
              </div>
            </div>
          </section>
        </div>
        <div *ngIf="media.length == 0" class="text-gray-300 text-lg text-center">
           No posts available
        </div>
      </div>

      <!-- Collection Grid -->
      <div *ngSwitchCase="'collections'" class="p-5 bg-gray-600 rounded-md m-3 collectionsContainer">
        <div *ngIf="collections?.length" class="flex flex-wrap justify-center gap-6 bg-gray-800 p-4 rounded-md">
          <div (click)="openDetailsDialog(collection)" *ngFor="let collection of collections; let i = index" [ngClass]="{
            'w-full': collections.length === 1,
            'w-1/2': collections.length === 2,
            'w-full sm:w-1/2 lg:w-1/3 xl:w-1/6': collections.length > 2
          }" class="relative group cursor-pointer overflow-hidden rounded-lg shadow-xl bg-gray-700 transform transition-all duration-300 hover:scale-105 hover:shadow-2xl collectionBoxes">

            <!-- Collection Thumbnail -->
            <img [src]="collection.media[0]"
              class="w-full h-60 object-cover transition-transform duration-300 group-hover:scale-110"
              alt="{{ collection.title }}" />

            <!-- Overlay -->
            <div
              class="absolute inset-0 bg-black bg-opacity-40 flex flex-col items-center justify-center opacity-0 transition-opacity duration-300 group-hover:opacity-100">
              <p class="text-white text-lg font-semibold">{{ collection.title }}</p>
              <p class="text-gray-300 text-sm text-center">{{ collection.description }}</p>
            </div>
          </div>
        </div>
        <div *ngIf="collections?.length === 0" class="text-gray-300 text-lg text-center mt-8">
          No collections available.
        </div>
      </div>

      <!-- Followers Section -->
      <div *ngSwitchCase="'followers'"
        class="section flex flex-col items-center justify-start mt-10 bg-slate-700 rounded-sm p-8 m-4 cursor-pointer shadow-lg transition duration-300 hover:scale-110 active:scale-95 followersContainer">

        <!-- Followers List Grid -->
        <div *ngIf="followers.length > 0"
          class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6 w-full">
          <!-- Follower Card -->
          <div *ngFor="let follower of followers" class="flex items-center gap-4 p-4 bg-slate-600 rounded-lg shadow-xl followersData"
            (click)="openProfile(follower.userId, true)">

            <!-- Follower Profile Picture -->
            <img [src]="follower.profilePic || noPicture" alt={{noPicture}}
              class="w-16 h-16 rounded-full object-cover" />

            <!-- Follower Details -->
            <div>
              <h3 class="text-white font-semibold text-lg">{{ follower.username }}</h3>
            </div>
          </div>
        </div>

        <!-- No Followers Case -->
        <div *ngIf="followers?.length === 0" class="text-gray-300 text-lg text-center mt-8">
          No followers available.
        </div>

      </div>

      <!-- Following Section -->
      <div *ngSwitchCase="'following'" class="section flex flex-col items-center mt-10 bg-slate-700 rounded-sm p-8 m-4 followingContainer">
        <!-- Heading -->

        <div *ngIf="(following == undefined) " class="text-gray-300 text-lg">
          You don't follow anyone!
        </div>

        <div *ngIf="filteredFollowingList.length > 0"
          class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6 w-full followingData">
        
          <!-- Follower Card -->
          <div *ngFor="let following of filteredFollowingList" class="flex items-center gap-4 p-4 bg-slate-600 rounded-lg shadow-xl"
            (click)="openProfile(following.userId, true)">
        
            <!-- Follower Profile Picture -->
            <img [src]="following.profilePic || noPicture" alt= {{noPicture}}
              class="w-16 h-16 rounded-full object-cover" />
        
            <!-- Follower Details -->
            <div>
              <h3 class="text-white font-semibold text-lg">{{ following.username }}</h3>
            </div>
          </div>
        </div>
        
        <div *ngIf="filteredFollowingList.length === 0" class="text-gray-300 text-lg text-center mt-8">
          No following available.
        </div>
      </div>

    </div>
  </div>

  <div *ngIf="showAllContent == false" class="section-container">
     <div class="flex justify-center text-white font-normal text-3xl mt-4"> The Account is Private </div>
  </div>
</div>